import dataiku
from fastapi import APIRouter
from entities.users_entities import UserBase
from datetime import date

router = APIRouter()

@router.post("/", response_model=UserBase)
async def create_user(user: UserBase):
    # Ajouter l'utilisateur au dataset Dataiku
    dataiku_api_key = "VOTRE_CLE_API_DATAIKU"
    dataiku_project_key = "API_DATAIKU"
    dataiku_dataset_name = "users"
    
    dataiku_client = dataiku.api_client(api_key=dataiku_api_key)
    dataiku_project = dataiku_client.get_project(dataiku_project_key)
    dataiku_dataset = dataiku_project.get_dataset(dataiku_dataset_name)

    # CrÃ©er un enregistrement Ã  ajouter au dataset
    dataset_record = {
        "uid_user": user.uid_user,
        "first_name": user.first_name,
        "last_name": user.last_name,
        "email": user.email,
        "profile": user.profile
    }

    # Ajouter l'enregistrement au dataset
    dataiku_dataset.write_with_schema([dataset_record])

    return user
